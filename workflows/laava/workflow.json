{
  "schema": "v3",
  "id": "laava",
  "title": "formbio/laava",
  "workflowVersion": "v2.6.0",
  "displayName": "LAAVA: Long-read AAV Analysis",
  "description": "Perform standard analysis of AAV long-read sequencing data.",
  "type": "object",
  "categories": [
    "Gene Therapy",
    "PacBio"
  ],
  "config": {
      "executionEngine": "nextflow-single-node"
  },
  "inputs": {
    "ui_source_type": {
      "title": "Sequence input source (file or folder)",
      "format": "radio",
      "required": true,
      "type": "string",
      "default": "file_source",
      "enum": [
        {
          "name": "File (uBAM or FASTQ)",
          "id": "file_source"
        },
        {
          "name": "Folder (FASTQs)",
          "id": "folder_source"
        }
      ]
    },
    "seq_reads_file": {
      "title": "Sequencing reads file",
      "description": "PacBio long-read sequencing data (uBAM/FASTQ)",
      "help_text": "PacBio AAV sequencing HiFi/CCS reads as a file in unaligned BAM or FASTQ format. The PacBio instrument should have been run in AAV mode.",
      "filetype": ".bam|.fastq|fastq.gz|.fq|.fq.gz",
      "format": "file",
      "hidden": false,
      "required": true,
      "type": "string"
    },
    "seq_reads_folder": {
      "title": "Sequencing reads folder",
      "description": "PacBio long-read sequencing data (folder of uBAM/FASTQ)",
      "help_text": "Folder of PacBio AAV sequencing HiFi/CCS reads in unaligned BAM or FASTQ format. The PacBio instrument should have been run in AAV mode.",
      "filetype": ".bam|.fastq|fastq.gz|.fq|.fq.gz",
      "format": "dir-path",
      "hidden": true,
      "required": false,
      "type": "string"
    },
    "vector_type": {
      "title": "Vector type",
      "description": "Single-stranded or self-complementary",
      "help_text": "Whether the vector construct is designed to be single-stranded AAV (ssAAV), self-complementary AAV (scAAV), or unknown/unspecified.",
      "format": "radio",
      "required": true,
      "type": "string",
      "default": "unspecified",
      "enum": [
        {
          "name": "Single-stranded AAV (ssAAV)",
          "id": "ssaav"
        },
        {
          "name": "Self-complementary AAV (scAAV)",
          "id": "scaav"
        },
        {
          "name": "Unknown / Unspecified",
          "id": "unspecified"
        }
      ]
    },
    "vector_bed": {
      "title": "Vector annotation",
      "description": "Vector sequence annotation (BED)",
      "help_text": "Annotated vector region coordinates in 4-column BED format. Must include 1 region with the label 'vector'.",
      "filetype": ".bed",
      "format": "spreadsheet",
      "hidden": false,
      "required": true,
      "type": "string",
      "columnConfig": {
        ".bed": {
          "staticColumns": true,
          "columns": [
            {
              "name": "chrom",
              "required": true
            },
            {
              "name": "chromStart",
              "required": true
            },
            {
              "name": "chromEnd",
              "required": true
            },
            {
              "name": "name"
            }
          ]
        }
      }
    },
    "vector_fa": {
      "title": "Vector sequence",
      "description": "Vector plasmid reference sequence (FASTA)",
      "help_text": "Reference sequence for the vector plasmid. The annotations apply to this sequence.",
      "filetype": ".fa|.fasta|.dna|.fna",
      "format": "file",
      "hidden": false,
      "required": true,
      "type": "string"
    },
    "packaging_fa": {
      "title": "Packaging sequences",
      "description": "Helper and RepCap plasmids (if used) and other reference sequences (FASTA)",
      "help_text": "Reference sequences for the helper and rep/cap plasmids and other sequences of interest, such as Lambda, as a FASTA file with one or more records. This should not include the vector construct or host genome sequences.",
      "filetype": ".fa|.fasta|.dna|.fna",
      "format": "file",
      "hidden": false,
      "required": false,
      "type": "string"
    },
    "host_fa": {
      "title": "Host sequences",
      "description": "Host genome reference sequence (FASTA)",
      "help_text": "Reference sequence for the host genome.",
      "filetype": ".fa|.fasta|.dna|.fna",
      "format": "file",
      "hidden": false,
      "required": false,
      "type": "string"
    },
    "itr_label_1": {
      "title": "ITR region label 1",
      "description": "Left ITR label in annotation BED",
      "help_text": "Region label used in the vector annotation BED file to indicate the first (i.e. left, 5') inverted terminal repeat (ITR). This label is often 'ITR' or 'ITR-L', but can vary. Not case-sensitive.",
      "format": "text",
      "hidden": false,
      "required": false,
      "default": "ITR",
      "type": "string"
    },
    "itr_label_2": {
      "title": "ITR region label 2",
      "description": "Right ITR label in annotation BED",
      "help_text": "Region label used in the vector annotation BED file to indicate the second (i.e. right, 3') inverted terminal repeat (ITR). This label is often 'ITR' or 'ITR-R', but can vary. Not case-sensitive.",
      "format": "text",
      "hidden": false,
      "required": false,
      "default": "ITR",
      "type": "string"
    },
    "repcap_name": {
      "title": "RepCap sequence ID",
      "description": "RepCap plasmid sequence identifier used in the packaging FASTA file",
      "help_text": "Sequence identifier used in the packaging FASTA file (above) corresponding to the rep/cap plasmid reference sequence, if used. Leave this blank if a dual construct was used (rep/cap on the vector backbone) or you're unsure.",
      "format": "text",
      "hidden": false,
      "required": false,
      "default": "",
      "type": "string"
    },

    "helper_name": {
      "title": "Helper sequence ID",
      "description": "Helper plasmid sequence identifier used in the packaging FASTA file",
      "help_text": "Sequence identifier used in the packaging FASTA file (above) corresponding to the helper plasmid reference sequence, if used. Leave this blank if you're unsure.",
      "format": "text",
      "hidden": false,
      "required": false,
      "default": "",
      "type": "string"
    },
    "lambda_name": {
      "title": "Lambda sequence ID",
      "description": "Lambda phage sequence identifier used in the packaging FASTA file",
      "help_text": "Sequence identifier used in the packaging FASTA file (above) corresponding to the lambda phage reference sequence, if used.",
      "format": "text",
      "hidden": false,
      "required": false,
      "default": "",
      "type": "string"
    },
    "flipflop_name": {
      "title": "AAV Serotype",
      "description": "AAV serotype name for flip/flop analysis",
      "help_text": "Serotype name for ITR flip/flop analysis, e.g. 'AAV2'. Leave blank to skip flip/flop analysis.",
      "format": "text",
      "hidden": false,
      "required": false,
      "default": "",
      "type": "string"
    },
    "flipflop_fa": {
      "title": "Flip/flop sequences",
      "description": "Flip/flop ITR sequences (FASTA).",
      "help_text": "Provide for flip/flop analysis if serotype is not AAV2 (which is built in), and provide a different value for flipflop_name. FASTA file must have 4 records with the exact sequence IDs SEQ_LEFT_FLIP, SEQ_LEFT_FLOP, SEQ_RIGHT_FLIP, SEQ_RIGHT_FLOP.",
      "filetype": ".fa|.fasta|.dna|.fna",
      "format": "file",
      "hidden": false,
      "required": false,
      "type": "string"
    },
    "target_gap_threshold": {
      "title": "Target gap threshold",
      "description": "",
      "help_text":  "Maximum total gap size allowed in the target region alignment to count a read as 'full'; skipping through the on-target region for more than this is considered 'full-gap'.",
      "type": "integer",
      "hidden": false,
      "required": true,
      "default": 200,
      "minimum": 0,
      "maximum": 1000
    },
    "max_allowed_outside_vector": {
      "title": "Max allowed outside vector",
      "description": "",
      "help": "Maximum allowed, in bp, outside the annotated vector region for a read that fully covers the vector region to be still considered 'full' rather than 'vector+backbone'.",
      "type": "integer",
      "hidden": false,
      "required": true,
      "default": 100,
      "minimum": 0,
      "maximum": 200
    },
    "max_allowed_missing_flanking": {
      "title": "Max allowed missing from ITR flank",
      "description": "",
      "help": "Maximum allowed, in bp, missing from the left and right flanks of the annotated vector region to be still considered 'full' rather than 'partial'.",
      "type": "integer",
      "hidden": false,
      "required": true,
      "default": 100,
      "minimum": 0,
      "maximum": 200
    },
    "container_version": {
      "title": "Container version",
      "description": "Use 'latest' for development",
      "help_text": "",
      "format": "text",
      "hidden": true,
      "required": false,
      "type": "string"
    }
  },
  "conditionals": [
    {
      "if": [
        {
          "ui_source_type": {
            "eq": "folder_source"
          }
        }
      ],
      "then": {
        "inputs": {
          "seq_reads_file": {
            "hidden": true,
            "required": false
          },
          "seq_reads_folder": {
            "hidden": false,
            "required": true
          }
        }
      }
    }
  ],
  "ui": {
    "inputs": [
      {
        "id": "workflowinputs",
        "title": "Inputs",
        "description": "Analysis inputs",
        "hidden": false,
        "help_text": "Input files for analysis",
        "fields": [
          "ui_source_type",
          "seq_reads_file",
          "seq_reads_folder",
          "vector_type",
          "vector_bed",
          "vector_fa",
          "packaging_fa",
          "host_fa",
          "itr_label_1",
          "itr_label_2",
          "repcap_name",
          "helper_name",
          "lambda_name",
          "flipflop_name",
          "flipflop_fa"
        ]
      },
      {
        "id": "workflowconfigs",
        "title": "Advanced Configuration",
        "description": "Advanced configuration settings",
        "hidden": false,
        "help_text": "Advanced configuration values for read classification",
        "fields": [
          "target_gap_threshold",
          "max_allowed_outside_vector",
          "max_allowed_missing_flanking"
        ]
      }
    ]
  }
}
